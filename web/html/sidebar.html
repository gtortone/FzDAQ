<html>
<head>
    <link rel="stylesheet" type="text/css" href="/web/css/w2ui-1.4.2.min.css" />
    <script src="/web/css/jquery.min.js"></script>
    <script type="text/javascript" src="/web/js/w2ui-1.4.2.min.js"></script>
    <script type="text/javascript" src="/web/js/highcharts.js"></script>
    <script type="text/javascript" src="/web/js/themes/grid.js"></script>
    <script type="text/javascript" src="/web/js/highcharts-more.js"></script>
    <script type="text/javascript" src="/web/js/modules/solid-gauge.js"></script>
</head>
<body>

<div id="sidebar" style="height: 300px; width: 180px;"></div>

<script type="text/javascript">

var report;
var turn = 5;	// first time refresh sidebar
var url = "";
url = url.concat("http://", window.location.host, "/report");

function refreshReport() {

   var xmlhttp = new XMLHttpRequest();
   xmlhttp.open("GET", url, true);

   xmlhttp.onload = function (e) {
      
      if (xmlhttp.readyState === 4) {
         if (xmlhttp.status === 200) {
            report = JSON.parse(xmlhttp.responseText);
            if(turn == 5) {

               turn = 0;

               // delete all nodes
               var nd = []; 
               for (var i in w2ui.sidebar.nodes[0].nodes) {
                  nd.push(w2ui.sidebar.nodes[0].nodes[i].id);
               }
               w2ui.sidebar.remove.apply(w2ui.sidebar, nd);

               for(i = 0; i < report.length; i++) {
                  var ref = "";
                  ref = ref.concat(i,"/",report[i].profile);
                  w2ui.sidebar.add('nodelist', { id: ref, text: report[i].hostname } );
               }
            } else turn = turn + 1;

         } else {
            console.error(xmlhttp.statusText);
         }
      } 
   };
   xmlhttp.send(null);
}

$(function () {
    $('#sidebar').w2sidebar({
        name: 'sidebar',
        nodes: [ 
            { id: 'nodelist', text: 'FzDAQ nodes', img: 'icon-folder', expanded: true }
        ]
    });

    w2ui.sidebar.on('click', function(event) {
       if(event.node.id != 'nodelist') {
          
          var ref = "";
          var url = "";
          ref = event.node.id;
          var index = ref.substr(0,ref.indexOf('/'));
          var page = ref.substr(ref.indexOf('/') + 1, ref.length - 1);
          url = url.concat("/web/html/",page,".html"); 
 
          top.index = index;
          top.report = report;

          w2ui.layout.load('main', url);

       } else {
          
          w2ui.layout.content('main', "");
       }
    });

    refreshReport();
    setInterval(refreshReport, 1000);
});

</script>

</body>
</html>
